#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ุงุณุชุนุงุฏุฉ ูุญุชูู ุงูุฏุฑูุณ ูุฅุถุงูุฉ ุจููู ุงูุฃุณุฆูุฉ ุงููุฎุตุตุฉ
"""

import os
import re
import glob

# ุจููู ุงูุฃุณุฆูุฉ ููู ุฏุฑุณ
question_banks = {
    "unit-1-cells/lesson-1-1": [
        {
            "q": "ุฃู ุชุฑููุจ ููุฌุฏ ูู ุงูุฎูุงูุง ุงููุจุงุชูุฉ ููุทุ",
            "c": ["ุงูููุชูููุฏุฑูุง", "ุงูุฌุฏุงุฑ ุงูุฎููู", "ุงูุบุดุงุก ุงูุฎููู", "ุงูุณูุชูุจูุงุฒู"],
            "a": 1
        },
        {
            "q": "ูุธููุฉ ุงูุจูุงุณุชูุฏุงุช ุงูุฎุถุฑุงุก:",
            "c": ["ุงูุชููุณ ุงูุฎููู", "ุงูุชูุซูู ุงูุถูุฆู", "ุชุฎุฒูู ุงููุงุก", "ุฅูุฑุงุฒ ุงููุฑูููุงุช"],
            "a": 1
        },
        {
            "q": "ุชุฑููุจ ููุฌุฏ ูู ูููู ูู ุงูุฎูุงูุง ุงููุจุงุชูุฉ ูุงูุญููุงููุฉ:",
            "c": ["ุฌุฏุงุฑ ุฎููู", "ุจูุงุณุชูุฏุงุช", "ููุงุฉ", "ูููุฑูููู"],
            "a": 2
        },
        {
            "q": "ุงูุนูุถููุฉ ุงููุณุคููุฉ ุนู ุฅูุชุงุฌ ูุนุธู ุทุงูุฉ ุงูุฎููุฉ:",
            "c": ["ุงูููุชูููุฏุฑูุง", "ุงูููุณูุณููุงุช", "ุฌูุงุฒ ุฌููุฌู", "ุงููุฌูุฉ"],
            "a": 0
        },
        {
            "q": "ุงููุฌูุฉ ุงูุนุตุงุฑูุฉ ุงููุจูุฑุฉ ูู ุงูุฎูุงูุง ุงููุจุงุชูุฉ ุชุณุงุนุฏ ุนูู:",
            "c": ["ุงูุชููุณ", "ุซุจุงุช ุงูุฎููุฉ ุจุชูููุฏ ุถุบุท ุงูุงูุชูุงุก ูุชุฎุฒูู ุงููุงุก", "ุจูุงุก ุงูุจุฑูุชูู", "ุชูุณูุฑ ุงูุณููู"],
            "a": 1
        },
    ],
    
    "unit-1-cells/lesson-1-2": [
        {
            "q": "ุงูุชูุจูุฑ ุงูููู ูููุฌูุฑ ููุญุณุจ ุจู:",
            "c": ["ุถุฑุจ ุชูุจูุฑ ุงูุนุฏุณุฉ ุงูุนูููุฉ ร ุชูุจูุฑ ุงูุนุฏุณุฉ ุงูุดูุฆูุฉ", "ุฌูุน ุงูุนุฏุณุชูู", "ูุณูุฉ ุงูุนูููุฉ ุนูู ุงูุดูุฆูุฉ", "ุทุฑุญ ุงูุนุฏุณุชูู"],
            "a": 0
        },
        {
            "q": "ุนูุฏ ุฑุณู ุงูุฎููุฉ ุนูููุงูุ ูุฌุจ:",
            "c": ["ุงุณุชุฎุฏุงู ุงูุฃููุงู ููุท", "ุฑุณู ุฎุทูุท ูุงุถุญุฉ ุจุงูููู ุงูุฑุตุงุต ูุน ุชุณููุงุช", "ุฑุณู ุงูุธูุงู", "ุงุณุชุฎุฏุงู ุงูุญุจุฑ ุงููููู"],
            "a": 1
        },
        {
            "q": "ุฅุฐุง ูุงู ุชูุจูุฑ ุงูุนุฏุณุฉ ุงูุนูููุฉ 10ร ูุงูุดูุฆูุฉ 40รุ ูุงูุชูุจูุฑ ุงูููู:",
            "c": ["50ร", "400ร", "30ร", "4ร"],
            "a": 1
        },
        {
            "q": "ุนูุฏ ุฒูุงุฏุฉ ุงูุชูุจูุฑ ูู ุงููุฌูุฑ:",
            "c": ["ูุฒุฏุงุฏ ุงูุถูุก ุชููุงุฆูุงู", "ุชูู ูููุฉ ุงูุถูุก ุงููุทููุจุฉ", "ุชุฒุฏุงุฏ ุงูุญุงุฌุฉ ูุถูุก ุฃูุซุฑ", "ูุง ูุชุบูุฑ ุดูุก"],
            "a": 2
        },
        {
            "q": "ุฃูู ูุงุนุฏุฉ ุนูุฏ ุฑุณู ุงูุฎูุงูุง:",
            "c": ["ุงูุฑุณู ุงูุณุฑูุน", "ุงููุณุจ ุงูุตุญูุญุฉ ูุงูุชุณููุงุช ุงููุงุถุญุฉ", "ุงุณุชุฎุฏุงู ุนุฏุฉ ุฃููุงู", "ุงูุฑุณู ุจุฎุท ุนุฑูุถ"],
            "a": 1
        }
    ],
    
    "unit-2-transport/lesson-2-1": [
        {
            "q": "ุงูุงูุชุดุงุฑ ูู ุญุฑูุฉ ุงูุฌุฒูุฆุงุช ูู ููุทูุฉ:",
            "c": ["ุชุฑููุฒ ููุฎูุถ ุฅูู ุนุงูู", "ุชุฑููุฒ ุนุงูู ุฅูู ููุฎูุถ", "ุจุงุฑุฏุฉ ุฅูู ุณุงุฎูุฉ", "ุญูุถูุฉ ุฅูู ูุงุนุฏูุฉ"],
            "a": 1
        },
        {
            "q": "ุงูุงูุชุดุงุฑ ุนูููุฉ:",
            "c": ["ุชุญุชุงุฌ ุทุงูุฉ", "ูุง ุชุญุชุงุฌ ุทุงูุฉ (ุณูุจูุฉ)", "ุชุญุชุงุฌ ุฅูุฒููุงุช", "ุชุญุชุงุฌ ูุฑูููุงุช"],
            "a": 1
        },
        {
            "q": "ุฃู ูู ุงูุชุงูู ูุซุงู ุนูู ุงูุงูุชุดุงุฑ:",
            "c": ["ุถุฎ ุงูููุจ ููุฏู", "ุงูุชุดุงุฑ ุงูุนุทุฑ ูู ุงูุบุฑูุฉ", "ูุถู ุงูุทุนุงู", "ุชููุต ุงูุนุถูุงุช"],
            "a": 1
        },
        {
            "q": "ุงูุนูุงูู ุงููุคุซุฑุฉ ุนูู ุณุฑุนุฉ ุงูุงูุชุดุงุฑ ุชุดูู:",
            "c": ["ูุฑู ุงูุชุฑููุฒ ูุงูุญุฑุงุฑุฉ", "ุงูููู ููุท", "ุนุฏุฏ ุงูุฎูุงูุง", "ููุน ุงูุทุนุงู"],
            "a": 0
        },
        {
            "q": "ุงูุงูุชุดุงุฑ ุงูุจุณูุท ูุญุฏุซ ุนุจุฑ:",
            "c": ["ุจุฑูุชููุงุช ูุงููุฉ", "ุงูุบุดุงุก ุงูุฎููู ูุจุงุดุฑุฉ", "ููุท ุงููุณุงู ุงูููููุฉ", "ุงูููุชูููุฏุฑูุง"],
            "a": 1
        }
    ],
    
    "unit-2-transport/lesson-2-2": [
        {
            "q": "ุงููุจุงุชุงุช ุชุญุตู ุนูู ุงููุงุก ุนุจุฑ:",
            "c": ["ุงูุฃูุฑุงู ููุท", "ุงูุดุนูุฑุงุช ุงูุฌุฐุฑูุฉ", "ุงูุณุงู ููุท", "ุงูุซูุงุฑ"],
            "a": 1
        },
        {
            "q": "ุงูุฎุดุจ ูู ุงููุจุงุช ูููู ุจู:",
            "c": ["ููู ุงูุณูุฑูุงุช", "ููู ุงููุงุก ูุงูุฃููุงุญ", "ุงูุชููุณ", "ุงูุชูุงุซุฑ"],
            "a": 1
        },
        {
            "q": "ุงููุญุงุก ูุญูู:",
            "c": ["ุงููุงุก ููุท", "ุงูุฃููุงุญ ููุท", "ุงูุณูุฑูุงุช ูุงูููุงุฏ ุงูุบุฐุงุฆูุฉ", "ุงูุฃูุณุฌูู"],
            "a": 2
        },
        {
            "q": "ุงูุดุนูุฑุงุช ุงูุฌุฐุฑูุฉ ุชุฒูุฏ:",
            "c": ["ุณูู ุงูุฌุฐุฑ", "ูุณุงุญุฉ ุงูุณุทุญ ูุงูุชุตุงุต ุงููุงุก", "ููุฉ ุงูุฌุฐุฑ", "ุทูู ุงููุจุงุช"],
            "a": 1
        },
        {
            "q": "ุงููุชุญ ูุณุงุนุฏ ูู:",
            "c": ["ุณุญุจ ุงููุงุก ูุฃุนูู ูู ุงููุจุงุช", "ุชูููู ุงูุจุฐูุฑ", "ููู ุงูุฌุฐูุฑ", "ุชูููู ุงูุฃุฒูุงุฑ"],
            "a": 0
        }
    ]
}

def create_question_bank_js(questions):
    """ุชุญููู ูุงุฆูุฉ ุงูุฃุณุฆูุฉ ุฅูู JavaScript"""
    js_questions = []
    for q in questions:
        choices_str = '", "'.join(q['c'])
        js_questions.append(f'{{q:"{q["q"]}", c:["{choices_str}"], a:{q["a"]}}}')
    
    return f"const bank = [\n      " + ",\n      ".join(js_questions) + "\n    ];"

def add_questions_to_lesson(file_path, lesson_key):
    """ุฅุถุงูุฉ ุงูุฃุณุฆูุฉ ุฅูู ููู ุงูุฏุฑุณ"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # ุงูุชุญูู ูู ูุฌูุฏ ุจูู ุงูุฃุณุฆูุฉ
        if 'const bank = [' in content:
            print(f"โ {lesson_key} - ุจูู ุงูุฃุณุฆูุฉ ููุฌูุฏ ูุณุจูุงู")
            return False
        
        # ุงูุจุญุซ ุนู ุงููููุน ุงูููุงุณุจ ูุฅุฏุฑุงุฌ ุจูู ุงูุฃุณุฆูุฉ
        insert_point = content.find('const el = {')
        
        if insert_point == -1:
            print(f"โ {lesson_key} - ูู ูุชู ุงูุนุซูุฑ ุนูู ููุทุฉ ุงูุฅุฏุฑุงุฌ")
            return False
            
        # ุฅูุดุงุก ุจูู ุงูุฃุณุฆูุฉ
        if lesson_key not in question_banks:
            print(f"โ๏ธ  {lesson_key} - ูุง ููุฌุฏ ุจูู ุฃุณุฆูุฉ ูุญุฏุฏ")
            return False
            
        questions_js = create_question_bank_js(question_banks[lesson_key])
        
        # ุฅุฏุฑุงุฌ ุจูู ุงูุฃุณุฆูุฉ
        new_content = (
            content[:insert_point] + 
            f"// ุจูู ุงูุฃุณุฆูุฉ ุงููุฎุตุต ููุฏุฑุณ\n    {questions_js}\n\n    " +
            content[insert_point:]
        )
        
        # ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ
        backup_path = file_path + '.backup_restore'
        with open(backup_path, 'w', encoding='utf-8') as f:
            f.write(content)
            
        # ูุชุงุจุฉ ุงููุญุชูู ุงูุฌุฏูุฏ
        with open(file_path, 'w', encoding='utf-8') as f:
            f.write(new_content)
            
        print(f"๐ง {lesson_key} - ุชู ุฅุถุงูุฉ {len(question_banks[lesson_key])} ุณุคุงู")
        return True
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ูุนุงูุฌุฉ {lesson_key}: {e}")
        return False

def main():
    """ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ"""
    print("๐ง ุจุฏุก ุงุณุชุนุงุฏุฉ ูุญุชูู ุงูุฏุฑูุณ...")
    print("=" * 60)
    
    fixed_count = 0
    
    # ูุนุงูุฌุฉ ุงูุฏุฑูุณ ุงููุญุฏุฏุฉ
    for lesson_key in question_banks.keys():
        file_path = f"{lesson_key}/index.html"
        if os.path.exists(file_path):
            if add_questions_to_lesson(file_path, lesson_key):
                fixed_count += 1
        else:
            print(f"โ {lesson_key} - ุงูููู ุบูุฑ ููุฌูุฏ")
    
    print()
    print("=" * 60)
    print(f"โ ุชู ุงูุงูุชูุงุก! ุชู ุฅุตูุงุญ {fixed_count} ุฏุฑุณ")
    
    if fixed_count > 0:
        print()
        print("๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ:")
        print("   1. ุงุฎุชุจุฑ ุงูุฏุฑูุณ ูู ุงููุชุตูุญ")
        print("   2. ุงุฑูุน ุงูุชุบููุฑุงุช ุนูู GitHub")
        print("   3. ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ูุญููุธุฉ ุจุงูุชุฏุงุฏ .backup_restore")

if __name__ == "__main__":
    main()