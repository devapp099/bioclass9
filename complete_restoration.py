#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
إكمال استعادة محتوى جميع الدروس - الجزء الثاني
"""

import os
import re
import glob

# بنوك الأسئلة الإضافية لباقي الدروس
additional_question_banks = {
    "unit-1-cells/lesson-1-3": [
        {
            "q": "العضيّة المسؤولة عن التحكم في أنشطة الخلية:",
            "c": ["الميتوكندريا", "النواة", "الريبوسومات", "الليسوسومات"],
            "a": 1
        },
        {
            "q": "وظيفة الريبوسومات:",
            "c": ["إنتاج الطاقة", "بناء البروتينات", "تفكيك النفايات", "تخزين الماء"],
            "a": 1
        },
        {
            "q": "جهاز جولجي يقوم بـ:",
            "c": ["التنفس", "تعديل وتغليف البروتينات", "تصنيع DNA", "امتصاص الضوء"],
            "a": 1
        },
        {
            "q": "الليسوسومات تحتوي على:",
            "c": ["هرمونات", "إنزيمات هاضمة", "ماء فقط", "أصباغ"],
            "a": 1
        },
        {
            "q": "الشبكة الإندوبلازمية الخشنة تتميز بوجود:",
            "c": ["ليسوسومات", "ريبوسومات", "ميتوكندريا", "بلاستيدات"],
            "a": 1
        }
    ],
    
    "unit-2-transport/lesson-2-3": [
        {
            "q": "الأسموزية هي انتشار:",
            "c": ["السكر", "الأملاح", "الماء عبر غشاء شبه منفذ", "البروتين"],
            "a": 2
        },
        {
            "q": "عند وضع خلية في محلول مخفف (منخفض التركيز):",
            "c": ["تنكمش", "تنتفخ بدخول الماء", "لا يحدث شيء", "تموت فوراً"],
            "a": 1
        },
        {
            "q": "المحلول المتساوي التوتر مع الخلية:",
            "c": ["يسبب انتفاخها", "يسبب انكماشها", "لا يؤثر على حجمها", "يدمرها"],
            "a": 2
        },
        {
            "q": "تجربة البطاطس في المحاليل تثبت:",
            "c": ["التنفس", "الأسموزية وتأثير التركيز", "التمثيل الضوئي", "الهضم"],
            "a": 1
        },
        {
            "q": "عندما تفقد الخلية النباتية الماء:",
            "c": ["تنتفخ", "يحدث ذبول", "تنمو أسرع", "تتضاعف"],
            "a": 1
        }
    ],
    
    "unit-3-biomolecules/lesson-3-1": [
        {
            "q": "الكربوهيدرات تشمل:",
            "c": ["السكريات والنشا", "البروتينات فقط", "الدهون فقط", "الفيتامينات فقط"],
            "a": 0
        },
        {
            "q": "اختبار بنديكت يكشف عن:",
            "c": ["البروتين", "السكريات المختزلة", "الدهون", "الأحماض النووية"],
            "a": 1
        },
        {
            "q": "اختبار اليود يكشف عن:",
            "c": ["السكر", "النشا", "البروتين", "الدهون"],
            "a": 1
        },
        {
            "q": "لون اختبار بنديكت الإيجابي:",
            "c": ["أزرق", "أحمر-برتقالي", "أسود", "أخضر"],
            "a": 1
        },
        {
            "q": "الجلوكوز يُصنف كـ:",
            "c": ["سكر ثنائي", "سكر أحادي", "نشا", "بروتين"],
            "a": 1
        }
    ],
    
    "unit-3-biomolecules/lesson-3-2": [
        {
            "q": "اختبار البيوريت يكشف عن:",
            "c": ["الكربوهيدرات", "البروتينات", "الدهون", "الأملاح"],
            "a": 1
        },
        {
            "q": "لون اختبار البيوريت الإيجابي:",
            "c": ["أحمر", "بنفسجي/أرجواني", "أخضر", "أصفر"],
            "a": 1
        },
        {
            "q": "الفرضية العلمية يجب أن تكون:",
            "c": ["قابلة للاختبار", "معقدة جداً", "مؤكدة مسبقاً", "غير قابلة للتغيير"],
            "a": 0
        },
        {
            "q": "المتغير المستقل في التجربة:",
            "c": ["ما نقيسه", "ما نغيره", "ما نتركه ثابتاً", "النتيجة"],
            "a": 1
        },
        {
            "q": "المتغير التابع هو:",
            "c": ["ما نتحكم فيه", "ما نقيسه كنتيجة", "الأدوات المستخدمة", "المكان"],
            "a": 1
        }
    ],
    
    "unit-3-biomolecules/lesson-3-3": [
        {
            "q": "الإنزيمات هي:",
            "c": ["كربوهيدرات", "بروتينات محفزة", "دهون", "أحماض نووية"],
            "a": 1
        },
        {
            "q": "العوامل المؤثرة على نشاط الإنزيم تشمل:",
            "c": ["الحرارة والـ pH", "اللون فقط", "الحجم فقط", "العمر فقط"],
            "a": 0
        },
        {
            "q": "الحرارة العالية جداً تؤثر على الإنزيم بـ:",
            "c": ["زيادة النشاط", "تفكيك (تمسخ) الإنزيم", "لا تأثير", "تغيير اللون فقط"],
            "a": 1
        },
        {
            "q": "الـ pH الأمثل لمعظم الإنزيمات البشرية:",
            "c": ["حمضي جداً", "قاعدي جداً", "متعادل تقريباً", "متغير باستمرار"],
            "a": 2
        },
        {
            "q": "الإنزيم والمادة المتفاعلة تكوّن:",
            "c": ["معقد إنزيم-مادة مؤقت", "مركب دائم", "غاز", "ماء فقط"],
            "a": 0
        }
    ],
    
    "unit-4-nutrition/lesson-4-1": [
        {
            "q": "التمثيل الضوئي يحدث في:",
            "c": ["الميتوكندريا", "البلاستيدات الخضراء", "النواة", "الفجوة"],
            "a": 1
        },
        {
            "q": "المعادلة العامة للتمثيل الضوئي:",
            "c": ["CO2 + H2O + ضوء → جلوكوز + O2", "جلوكوز + O2 → CO2 + H2O", "H2O فقط", "CO2 فقط"],
            "a": 0
        },
        {
            "q": "العوامل المحددة للتمثيل الضوئي:",
            "c": ["شدة الضوء، CO2، الحرارة", "اللون فقط", "الوقت فقط", "حجم الورقة فقط"],
            "a": 0
        },
        {
            "q": "الكلوروفيل يمتص الضوء:",
            "c": ["الأخضر فقط", "الأحمر والأزرق أكثر من الأخضر", "البنفسجي فقط", "جميع الألوان بنفس القدر"],
            "a": 1
        },
        {
            "q": "نواتج التمثيل الضوئي:",
            "c": ["CO2 والماء", "الجلوكوز والأكسجين", "النيتروجين", "الأحماض"],
            "a": 1
        }
    ],
    
    "unit-4-nutrition/lesson-4-2": [
        {
            "q": "اختبار الورقة للنشا يستخدم:",
            "c": ["بنديكت", "اليود", "البيوريت", "الماء المقطر"],
            "a": 1
        },
        {
            "q": "قبل اختبار الورقة للنشا، نقوم بـ:",
            "c": ["إزالة الكلوروفيل بالكحول", "تسخينها فقط", "تبريدها", "قطعها"],
            "a": 0
        },
        {
            "q": "لون اليود عند وجود النشا:",
            "c": ["أحمر", "أزرق-أسود", "أخضر", "شفاف"],
            "a": 1
        },
        {
            "q": "سبب إزالة الكلوروفيل من الورقة:",
            "c": ["لرؤية تغيير لون اليود بوضوح", "لتسريع التفاعل", "لتنظيف الورقة", "لا سبب"],
            "a": 0
        },
        {
            "q": "النشا في الورقة يدل على:",
            "c": ["حدوث التنفس", "حدوث التمثيل الضوئي", "وجود الماء", "وجود المعادن"],
            "a": 1
        }
    ],
    
    "unit-5-respiration/lesson-5-1": [
        {
            "q": "التنفس الهوائي يحتاج:",
            "c": ["أكسجين", "نيتروجين فقط", "هيدروجين فقط", "كربون فقط"],
            "a": 0
        },
        {
            "q": "التنفس اللاهوائي يحدث:",
            "c": ["بوجود الأكسجين", "بدون أكسجين", "في الضوء فقط", "في الماء فقط"],
            "a": 1
        },
        {
            "q": "التنفس الهوائي أكثر كفاءة لأنه ينتج:",
            "c": ["ATP أقل", "ATP أكثر", "سكر أكثر", "ماء أقل"],
            "a": 1
        },
        {
            "q": "مثال على التنفس اللاهوائي:",
            "c": ["تنفس الإنسان", "تخمر الخميرة", "تنفس الأسماك", "تنفس الطيور"],
            "a": 1
        },
        {
            "q": "معادلة التنفس الهوائي:",
            "c": ["جلوكوز + O2 → CO2 + H2O + ATP", "CO2 + H2O → جلوكوز", "O2 فقط", "H2O فقط"],
            "a": 0
        }
    ],
    
    "unit-6-homeostasis/lesson-6-1": [
        {
            "q": "تنظيم درجة الحرارة في الجسم يسمى:",
            "c": ["التنفس", "التنظيم الحراري", "الهضم", "الإخراج"],
            "a": 1
        },
        {
            "q": "عند ارتفاع درجة حرارة الجسم:",
            "c": ["نرتجف", "نتعرق ونتوسع الأوعية", "نأكل أكثر", "ننام"],
            "a": 1
        },
        {
            "q": "عند انخفاض درجة حرارة الجسم:",
            "c": ["نتعرق", "نرتجف وتنقبض الأوعية", "نتنفس أسرع", "نشرب ماء"],
            "a": 1
        },
        {
            "q": "مركز تنظيم الحرارة في:",
            "c": ["القلب", "الدماغ (تحت المهاد)", "الكبد", "الرئتين"],
            "a": 1
        },
        {
            "q": "التنظيم الحراري مثال على:",
            "c": ["التوازن الداخلي", "التنفس", "الهضم", "النمو"],
            "a": 0
        }
    ],
    
    "unit-6-homeostasis/lesson-6-2": [
        {
            "q": "الكليتان تنظمان:",
            "c": ["الحرارة", "توازن الماء والأملاح", "التنفس", "الهضم"],
            "a": 1
        },
        {
            "q": "الهرمون المضاد لإدرار البول (ADH) يفرز من:",
            "c": ["الكلى", "الغدة النخامية", "الكبد", "القلب"],
            "a": 1
        },
        {
            "q": "عند نقص الماء في الجسم:",
            "c": ["يقل إفراز ADH", "يزداد إفراز ADH", "لا يتغير شيء", "تتوقف الكلى"],
            "a": 1
        },
        {
            "q": "ADH يؤثر على:",
            "c": ["القلب", "الكلى لإعادة امتصاص الماء", "الرئتين", "المعدة"],
            "a": 1
        },
        {
            "q": "توازن الماء في الجسم يحافظ على:",
            "c": ["درجة الحرارة فقط", "تركيز الدم وضغطه", "لون الدم", "سرعة الدورة"],
            "a": 1
        }
    ],
    
    "unit-6-homeostasis/lesson-6-3": [
        {
            "q": "الجهاز العصبي يتكون من:",
            "c": ["القلب والرئتين", "الدماغ والحبل الشوكي والأعصاب", "الكلى والكبد", "العضلات فقط"],
            "a": 1
        },
        {
            "q": "رد الفعل المنعكس:",
            "c": ["يحتاج تفكير", "تلقائي وسريع للحماية", "بطيء جداً", "يحدث في القلب"],
            "a": 1
        },
        {
            "q": "مثال على رد الفعل المنعكس:",
            "c": ["الدراسة للامتحان", "سحب اليد من شيء ساخن", "تناول الطعام", "النوم"],
            "a": 1
        },
        {
            "q": "النخاع الشوكي يقوم بـ:",
            "c": ["الهضم", "نقل الرسائل وردود الأفعال", "التنفس فقط", "ضخ الدم"],
            "a": 1
        },
        {
            "q": "السيالة العصبية تنتقل عبر:",
            "c": ["الدم", "الأعصاب", "العضلات", "العظام"],
            "a": 1
        }
    ],
    
    "unit-6-homeostasis/lesson-6-4": [
        {
            "q": "التجارب العلمية تحتاج:",
            "c": ["مجموعة تجريبية ومجموعة ضابطة", "مجموعة واحدة فقط", "نتائج مسبقة", "أدوات باهظة فقط"],
            "a": 0
        },
        {
            "q": "المجموعة الضابطة:",
            "c": ["تتعرض للمتغير", "لا تتعرض للمتغير المختبر", "تُلغى من التجربة", "تُكرر مرتين"],
            "a": 1
        },
        {
            "q": "الملاحظة العلمية يجب أن تكون:",
            "c": ["موضوعية ودقيقة", "شخصية فقط", "سريعة", "بدون تسجيل"],
            "a": 0
        },
        {
            "q": "تكرار التجربة مهم لـ:",
            "c": ["إضاعة الوقت", "التأكد من صحة النتائج", "استخدام أدوات أكثر", "إثارة الاهتمام"],
            "a": 1
        },
        {
            "q": "تسجيل البيانات يساعد في:",
            "c": ["تحليل النتائج واستخلاص النتائج", "تعقيد التجربة", "إلغاء التجربة", "تغيير الفرضية"],
            "a": 0
        }
    ]
}

def create_question_bank_js(questions):
    """تحويل قائمة الأسئلة إلى JavaScript"""
    js_questions = []
    for q in questions:
        choices_str = '", "'.join(q['c'])
        js_questions.append(f'{{q:"{q["q"]}", c:["{choices_str}"], a:{q["a"]}}}')
    
    return f"const bank = [\n      " + ",\n      ".join(js_questions) + "\n    ];"

def add_questions_to_lesson(file_path, lesson_key):
    """إضافة الأسئلة إلى ملف الدرس"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # التحقق من وجود بنك الأسئلة
        if 'const bank = [' in content:
            print(f"✅ {lesson_key} - بنك الأسئلة موجود مسبقاً")
            return False
        
        # البحث عن الموقع المناسب لإدراج بنك الأسئلة
        insert_point = content.find('const el = {')
        
        if insert_point == -1:
            print(f"❌ {lesson_key} - لم يتم العثور على نقطة الإدراج")
            return False
            
        # إنشاء بنك الأسئلة
        if lesson_key not in additional_question_banks:
            print(f"⚠️  {lesson_key} - لا يوجد بنك أسئلة محدد")
            return False
            
        questions_js = create_question_bank_js(additional_question_banks[lesson_key])
        
        # إدراج بنك الأسئلة
        new_content = (
            content[:insert_point] + 
            f"// بنك الأسئلة المخصص للدرس\n    {questions_js}\n\n    " +
            content[insert_point:]
        )
        
        # إنشاء نسخة احتياطية
        backup_path = file_path + '.backup_restore_2'
        with open(backup_path, 'w', encoding='utf-8') as f:
            f.write(content)
            
        # كتابة المحتوى الجديد
        with open(file_path, 'w', encoding='utf-8') as f:
            f.write(new_content)
            
        print(f"🔧 {lesson_key} - تم إضافة {len(additional_question_banks[lesson_key])} سؤال")
        return True
        
    except Exception as e:
        print(f"❌ خطأ في معالجة {lesson_key}: {e}")
        return False

def main():
    """الدالة الرئيسية"""
    print("🔧 إكمال استعادة محتوى باقي الدروس...")
    print("=" * 60)
    
    fixed_count = 0
    
    # معالجة الدروس المحددة
    for lesson_key in additional_question_banks.keys():
        file_path = f"{lesson_key}/index.html"
        if os.path.exists(file_path):
            if add_questions_to_lesson(file_path, lesson_key):
                fixed_count += 1
        else:
            print(f"❌ {lesson_key} - الملف غير موجود")
    
    print()
    print("=" * 60)
    print(f"✅ تم الانتهاء! تم إصلاح {fixed_count} درس إضافي")
    
    if fixed_count > 0:
        print()
        print("🎯 الخطوات التالية:")
        print("   1. اختبر الدروس في المتصفح")
        print("   2. ارفع التغييرات على GitHub")
        print("   3. النسخ الاحتياطية محفوظة بامتداد .backup_restore_2")

if __name__ == "__main__":
    main()