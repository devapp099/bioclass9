#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ุฅุตูุงุญ ุฌุฐุฑู ุดุงูู - ูุณุฎ ุงูุฏุฑุณ ุงููุซุงูู 1-1 ูุชุทุจููู ุนูู ุฌููุน ุงูุฏุฑูุณ
Radical comprehensive fix - Copy perfect lesson 1-1 structure to all lessons
"""

import os
import re
from pathlib import Path

# ูุงุฆูุฉ ุงูุฏุฑูุณ ูุน ูุนูููุงุชูุง
LESSONS_DATA = {
    "lesson-1-2": {
        "title": "๐งช ุฏุฑุณ 1-2 โ ุฑุณู ุงูุฎูุงูุง ูุญุณุงุจ ุงูุชูุจูุฑ",
        "h1": "ุฑุณู ุงูุฎูุงูุง ูุญุณุงุจ ุงูุชูุจูุฑ",
        "lead": "ุชุนูู ููููุฉ ุฑุณู ุงูุฎูุงูุง ุจุดูู ุนููู ุฏููู ูุญุณุงุจ ุงูุชูุจูุฑ ุงููุทููุจ ูููุดุงูุฏุฉ ุงููุซูู"
    },
    "lesson-1-3": {
        "title": "๐ ุฏุฑุณ 1-3 โ ุฃุฌุฒุงุก ุงูุฎููุฉ ููุธุงุฆููุง",
        "h1": "ุฃุฌุฒุงุก ุงูุฎููุฉ ููุธุงุฆููุง",
        "lead": "ุงุณุชูุดู ุงูุชุฑุงููุจ ุงููุฎุชููุฉ ุฏุงุฎู ุงูุฎููุฉ ููุธุงุฆููุง ุงูุญูููุฉ ุงููุชุฎุตุตุฉ"
    },
    "lesson-2-1": {
        "title": "๐ ุฏุฑุณ 2-1 โ ุงูููู ุนุจุฑ ุงูุฃุบุดูุฉ",
        "h1": "ุงูููู ุนุจุฑ ุงูุฃุบุดูุฉ",
        "lead": "ููู ุขููุงุช ุงูููู ุงููุฎุชููุฉ ุนุจุฑ ุฃุบุดูุฉ ุงูุฎูุงูุง ูุงูุนูุงูู ุงููุคุซุฑุฉ ุนูููุง"
    },
    "lesson-2-2": {
        "title": "๐ง ุฏุฑุณ 2-2 โ ุงูุงูุชุดุงุฑ ูุงูุฎุงุตูุฉ ุงูุฃุณููุฒูุฉ",
        "h1": "ุงูุงูุชุดุงุฑ ูุงูุฎุงุตูุฉ ุงูุฃุณููุฒูุฉ",
        "lead": "ุชุนูู ููุงููู ุงูุงูุชุดุงุฑ ูุงูุฃุณููุฒูุฉ ูุชุทุจููุงุชูุง ูู ุงูุฎูุงูุง ุงูุญูุฉ"
    },
    "lesson-2-3": {
        "title": "โก ุฏุฑุณ 2-3 โ ุงูููู ุงููุดุท ูุงูุณูุจู",
        "h1": "ุงูููู ุงููุดุท ูุงูุณูุจู",
        "lead": "ุงูููุงุฑูุฉ ุจูู ุฃููุงุน ุงูููู ุงููุฎุชููุฉ ููุชุทูุจุงุช ุงูุทุงูุฉ ููู ูููุง"
    },
    "lesson-3-1": {
        "title": "๐งฌ ุฏุฑุณ 3-1 โ ุงููุฑุจูููุฏุฑุงุช ูุงูุฏููู",
        "h1": "ุงููุฑุจูููุฏุฑุงุช ูุงูุฏููู",
        "lead": "ุฏุฑุงุณุฉ ุชุฑููุจ ููุธุงุฆู ุงููุฑุจูููุฏุฑุงุช ูุงูุฏููู ูู ุงููุงุฆูุงุช ุงูุญูุฉ"
    },
    "lesson-3-2": {
        "title": "๐งช ุฏุฑุณ 3-2 โ ุงูุจุฑูุชููุงุช ูุงูุฃุญูุงุถ ุงูููููุฉ",
        "h1": "ุงูุจุฑูุชููุงุช ูุงูุฃุญูุงุถ ุงูููููุฉ",
        "lead": "ููู ุงูุชุฑููุจ ุงููุนูุฏ ููุจุฑูุชููุงุช ูุงูุฃุญูุงุถ ุงูููููุฉ ููุธุงุฆููุง"
    },
    "lesson-3-3": {
        "title": "โ๏ธ ุฏุฑุณ 3-3 โ ุงูุฅูุฒููุงุช ูุขููุฉ ุนูููุง",
        "h1": "ุงูุฅูุฒููุงุช ูุขููุฉ ุนูููุง",
        "lead": "ุงุณุชูุดุงู ุนุงูู ุงูุฅูุฒููุงุช ูุงูุนูุงูู ุงููุคุซุฑุฉ ุนูู ูุดุงุทูุง"
    },
    "lesson-4-1": {
        "title": "๐ ุฏุฑุณ 4-1 โ ุงูุชุบุฐูุฉ ูุงููุถู",
        "h1": "ุงูุชุบุฐูุฉ ูุงููุถู",
        "lead": "ููู ุนูููุงุช ุงูุชุบุฐูุฉ ูุงููุถู ูุฃูููุชูุง ูููุงุฆูุงุช ุงูุญูุฉ"
    },
    "lesson-4-2": {
        "title": "๐ ุฏุฑุณ 4-2 โ ุงูุงูุชุตุงุต ูุงูููู",
        "h1": "ุงูุงูุชุตุงุต ูุงูููู",
        "lead": "ุชุนูู ุขููุงุช ุงูุชุตุงุต ุงูููุงุฏ ุงูุบุฐุงุฆูุฉ ูููููุง ูู ุงูุฌุณู"
    },
    "lesson-5-1": {
        "title": "๐จ ุฏุฑุณ 5-1 โ ุงูุชููุณ ุงูุฎููู",
        "h1": "ุงูุชููุณ ุงูุฎููู",
        "lead": "ุฏุฑุงุณุฉ ุนูููุงุช ุฅูุชุงุฌ ุงูุทุงูุฉ ูู ุงูุฎูุงูุง ูุงูุนูุงูู ุงููุคุซุฑุฉ ุนูููุง"
    },
    "lesson-6-1": {
        "title": "โ๏ธ ุฏุฑุณ 6-1 โ ุงูุชูุงุฒู ุงููุงุฆู",
        "h1": "ุงูุชูุงุฒู ุงููุงุฆู", 
        "lead": "ููู ุขููุงุช ุงููุญุงูุธุฉ ุนูู ุงูุชูุงุฒู ุงููุงุฆู ูู ุงููุงุฆูุงุช ุงูุญูุฉ"
    },
    "lesson-6-2": {
        "title": "๐ก๏ธ ุฏุฑุณ 6-2 โ ุชูุธูู ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ",
        "h1": "ุชูุธูู ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ",
        "lead": "ุงุณุชูุดุงู ุทุฑู ุชูุธูู ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงูุฌุณู ูุงูุชููู ูุน ุงูุจูุฆุฉ"
    },
    "lesson-6-3": {
        "title": "๐ฌ ุฏุฑุณ 6-3 โ ุชูุธูู ุงูุณูุฑ ูู ุงูุฏู",
        "h1": "ุชูุธูู ุงูุณูุฑ ูู ุงูุฏู",
        "lead": "ุชุนูู ุขููุงุช ุงูุชุญูู ูู ูุณุชูู ุงูุณูุฑ ูุงููุฑูููุงุช ุงูููุธูุฉ"
    },
    "lesson-6-4": {
        "title": "๐ง ุฏุฑุณ 6-4 โ ุงูุฌูุงุฒ ุงูุนุตุจู ูุงูุชูุงุฒู",
        "h1": "ุงูุฌูุงุฒ ุงูุนุตุจู ูุงูุชูุงุฒู",
        "lead": "ููู ุฏูุฑ ุงูุฌูุงุฒ ุงูุนุตุจู ูู ุงููุญุงูุธุฉ ุนูู ุงูุชูุงุฒู ุงูุฏุงุฎูู"
    }
}

def read_perfect_lesson():
    """ูุฑุงุกุฉ ุงูุฏุฑุณ ุงููุซุงูู 1-1"""
    perfect_path = "unit-1-cells/lesson-1-1/index.html"
    try:
        with open(perfect_path, 'r', encoding='utf-8') as f:
            return f.read()
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ูุฑุงุกุฉ ุงูุฏุฑุณ ุงููุซุงูู: {e}")
        return None

def create_lesson_from_template(template_content, lesson_key, lesson_data):
    """ุฅูุดุงุก ุฏุฑุณ ุฌุฏูุฏ ูู ุงููุงูุจ ุงููุซุงูู"""
    content = template_content
    
    # ุชุบููุฑ ุงูุนููุงู
    content = re.sub(
        r'<title>[^<]+</title>',
        f'<title>{lesson_data["title"]}</title>',
        content
    )
    
    # ุชุบููุฑ H1
    content = re.sub(
        r'<h1>[^<]+</h1>',
        f'<h1>{lesson_data["h1"]}</h1>',
        content
    )
    
    # ุชุบููุฑ ุงูููุฏูุฉ
    content = re.sub(
        r'<p class="lead">[^<]+</p>',
        f'<p class="lead">{lesson_data["lead"]}</p>',
        content
    )
    
    return content

def fix_lesson_completely(lesson_path, lesson_key):
    """ุฅุตูุงุญ ุดุงูู ูุฏุฑุณ ูุงุญุฏ"""
    try:
        # ูุฑุงุกุฉ ุงููุงูุจ ุงููุซุงูู
        perfect_content = read_perfect_lesson()
        if not perfect_content:
            return False
        
        # ุงูุญุตูู ุนูู ุจูุงูุงุช ุงูุฏุฑุณ
        lesson_data = LESSONS_DATA.get(lesson_key)
        if not lesson_data:
            print(f"โ๏ธ  ุจูุงูุงุช ุบูุฑ ููุฌูุฏุฉ ูู {lesson_key}")
            return False
        
        # ุฅูุดุงุก ุงููุญุชูู ุงูุฌุฏูุฏ
        new_content = create_lesson_from_template(perfect_content, lesson_key, lesson_data)
        
        # ุญูุธ ุงูููู ุงูุฌุฏูุฏ
        with open(lesson_path, 'w', encoding='utf-8') as f:
            f.write(new_content)
        
        return True
        
    except Exception as e:
        print(f"โ ุฎุทุฃ ูู ุฅุตูุงุญ {lesson_path}: {e}")
        return False

def main():
    """ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ููุฅุตูุงุญ ุงูุฌุฐุฑู ุงูุดุงูู"""
    print("๐ ุจุฏุก ุงูุฅุตูุงุญ ุงูุฌุฐุฑู ุงูุดุงูู...")
    print("๐ ุณูุชู ูุณุฎ ุงูุฏุฑุณ ุงููุซุงูู 1-1 ูุชุทุจููู ุนูู ุฌููุน ุงูุฏุฑูุณ")
    
    # ูุฌูุฏุงุช ุงููุญุฏุงุช
    units = [
        'unit-1-cells',
        'unit-2-transport', 
        'unit-3-biomolecules',
        'unit-4-nutrition',
        'unit-5-respiration',
        'unit-6-homeostasis'
    ]
    
    fixed_count = 0
    total_count = 0
    
    for unit in units:
        unit_path = unit
        if os.path.exists(unit_path):
            # ุงูุจุญุซ ุนู ุฌููุน ุงูุฏุฑูุณ ูู ุงููุญุฏุฉ
            for item in os.listdir(unit_path):
                lesson_path = os.path.join(unit_path, item)
                if os.path.isdir(lesson_path) and item.startswith('lesson-'):
                    index_file = os.path.join(lesson_path, 'index.html')
                    if os.path.exists(index_file):
                        # ุชุฎุทู ุงูุฏุฑุณ 1-1 ูุฃูู ุงููุซุงูู
                        if item == 'lesson-1-1':
                            print(f"โญ ุชุฎุทู: {item} (ุงูุฏุฑุณ ุงููุซุงูู - ุงููุฑุฌุน)")
                            continue
                        
                        total_count += 1
                        print(f"๐ ุฅุตูุงุญ ุฌุฐุฑู: {item}")
                        
                        if fix_lesson_completely(index_file, item):
                            fixed_count += 1
                            print(f"โ ุชู ุงูุฅุตูุงุญ ุงูุฌุฐุฑู: {item}")
                        else:
                            print(f"โ ูุดู ุงูุฅุตูุงุญ: {item}")
    
    print(f"\n๐ ุงูุชูุงุก ุงูุฅุตูุงุญ ุงูุฌุฐุฑู ุงูุดุงูู!")
    print(f"โ ุชู ุฅุตูุงุญ {fixed_count} ุฏุฑุณ ูู ุฃุตู {total_count}")
    
    if fixed_count == total_count:
        print("๐ ุฌููุน ุงูุฏุฑูุณ ุฃุตุจุญุช ูุทุงุจูุฉ ุชูุงูุงู ููุฏุฑุณ ุงููุซุงูู!")
        print("๐ ูู ุฏุฑุณ ูุนูู ุจููุณ ุงูููุงุกุฉ ูุงูุฌูุฏุฉ ุงููุซุงููุฉ!")
    else:
        print(f"โ๏ธ  {total_count - fixed_count} ุฏุฑูุณ ุชุญุชุงุฌ ูุฑุงุฌุนุฉ")

if __name__ == "__main__":
    main()